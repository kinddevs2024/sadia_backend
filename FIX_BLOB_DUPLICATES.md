# Исправление проблемы с дубликатами файлов в Blob Storage

## Проблема

При каждом изменении данных в базе данных на Vercel создавался новый файл в Blob Storage, что приводило к накоплению дубликатов файлов.

## Решение

Исправлена функция `writeCollectionBlob` в `lib/db.ts`:

1. **Добавлена опция `allowOverwrite: true`** - позволяет обновлять существующий blob вместо создания нового
2. **Добавлена опция `addRandomSuffix: false`** - гарантирует, что имя файла остается одинаковым

## Что изменилось

### До:
```typescript
const { url } = await put(blobName, content, {
  access: 'public',
  contentType: 'application/json',
});
```

### После:
```typescript
const { url } = await put(blobName, content, {
  access: 'public',
  contentType: 'application/json',
  addRandomSuffix: false, // Keep the same filename
  allowOverwrite: true, // Overwrite existing blob instead of creating new one
});
```

## Результат

Теперь при каждом обновлении данных:
- ✅ Существующий файл обновляется (не создается новый)
- ✅ Нет накопления дубликатов файлов
- ✅ URL файла остается постоянным (кешируется для быстрого доступа)

## Очистка старых дубликатов

Если у вас уже накопились дубликаты файлов в Blob Storage:

1. Перейдите в настройки проекта на Vercel
2. Откройте вкладку "Storage" → "Blob"
3. Найдите файлы с префиксом `db/` (например, `db/products.json`)
4. Удалите старые версии, оставив только самую последнюю

Или используйте Vercel CLI:
```bash
vercel blob list --prefix db/
# Затем удалите старые версии вручную через веб-интерфейс
```

## Проверка

После деплоя изменений:
1. Сделайте любое изменение в базе данных (создайте/обновите товар, пользователя и т.д.)
2. Проверьте Blob Storage - должен быть только один файл для каждой коллекции
3. Убедитесь, что изменения сохраняются корректно
